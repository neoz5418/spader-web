"use strict";(self.webpackChunk_docsearch_website=self.webpackChunk_docsearch_website||[]).push([[2587],{5680:(e,n,t)=>{t.d(n,{xA:()=>u,yg:()=>g});var r=t(6540);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),p=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=p(e.components);return r.createElement(s.Provider,{value:n},e.children)},c="mdxType",y={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(t),d=a,g=c["".concat(s,".").concat(d)]||c[d]||y[d]||o;return t?r.createElement(g,i(i({ref:n},u),{},{components:t})):r.createElement(g,i({ref:n},u))}));function g(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=d;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[c]="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=t[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},4771:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>y,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var r=t(8168),a=(t(6540),t(5680));const o={title:"Run your own"},i=void 0,l={unversionedId:"run-your-own",id:"version-legacy/run-your-own",title:"Run your own",description:"If you want to update your results with more control, or if you are not compliant with our checklist, or if your website sits behind a firewall, you might want to run the crawler yourself.",source:"@site/versioned_docs/version-legacy/run-your-own.md",sourceDirName:".",slug:"/run-your-own",permalink:"/docs/legacy/run-your-own",draft:!1,editUrl:"https://github.com/spader-ai/spader-web/edit/main/packages/website/versioned_docs/version-legacy/run-your-own.md",tags:[],version:"legacy",lastUpdatedBy:"liuf",lastUpdatedAt:1728739082,formattedLastUpdatedAt:"Oct 12, 2024",frontMatter:{title:"Run your own"},sidebar:"version-legacy/docs",previous:{title:"How do we build a DocSearch index?",permalink:"/docs/legacy/how-do-we-build-an-index"}},s={},p=[{value:"Set up your environment",id:"set-up-your-environment",level:2},{value:"Run the crawl from the Docker image",id:"run-the-crawl-from-the-docker-image",level:2},{value:"Running the crawler from the code base",id:"running-the-crawler-from-the-code-base",level:2},{value:"Installation",id:"installation",level:3},{value:"Installing Chrome driver",id:"installing-chrome-driver",level:3},{value:"Running the crawler",id:"running-the-crawler",level:3},{value:"Create a new configuration",id:"create-a-new-configuration",level:2},{value:"Testing your results",id:"testing-your-results",level:2},{value:"Integration",id:"integration",level:2},{value:"Help",id:"help",level:2}],u={toc:p},c="wrapper";function y(e){let{components:n,...t}=e;return(0,a.yg)(c,(0,r.A)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.yg)("p",null,"If you want to update your results with more control, or if you are ",(0,a.yg)("a",{parentName:"p",href:"/docs/who-can-apply"},"not compliant with our checklist"),", or if your website sits behind a firewall, you might want to run the crawler yourself."),(0,a.yg)("p",null,"The whole code base of DocSearch is open source, and we package it as a Docker image to make this even easier for you to use."),(0,a.yg)("h2",{id:"set-up-your-environment"},"Set up your environment"),(0,a.yg)("p",null,"You'll need to set your Spader application ID and admin API key as environment variables. If you don't have an Spader account, you need to ",(0,a.yg)("a",{parentName:"p",href:"https://www.spader.com/pricing"},"create one"),"."),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("inlineCode",{parentName:"p"},"APPLICATION_ID")," set to your Spader Application ID")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("inlineCode",{parentName:"p"},"API_KEY")," set to your API Key. Make sure to use an API key with ",(0,a.yg)("strong",{parentName:"p"},"write")," access to your index. It needs ",(0,a.yg)("a",{parentName:"p",href:"https://www.spader.com/doc/guides/security/api-keys/#acl"},"the ACL ",(0,a.yg)("inlineCode",{parentName:"a"},"addObject"),", ",(0,a.yg)("inlineCode",{parentName:"a"},"editSettings")," and ",(0,a.yg)("inlineCode",{parentName:"a"},"deleteIndex")),"."))),(0,a.yg)("p",null,"For convenience, you can create a ",(0,a.yg)("inlineCode",{parentName:"p"},".env")," file in the repository root."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},"APPLICATION_ID=YOUR_APP_ID\nAPI_KEY=YOUR_API_KEY\n")),(0,a.yg)("h2",{id:"run-the-crawl-from-the-docker-image"},"Run the crawl from the Docker image"),(0,a.yg)("p",null,"You can run a crawl from the packaged Docker image to crawl your website. You will need to ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/stedolan/jq/wiki/Installation"},"install jq, a lightweight command-line JSON processor")),(0,a.yg)("p",null,"Then you need to start the crawl according to your configuration. You should check the ",(0,a.yg)("a",{parentName:"p",href:"/docs/legacy/config-file"},"dedicated configuration documentation"),"."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},'docker run -it --env-file=.env -e "CONFIG=$(cat /path/to/your/config.json | jq -r tostring)" spader/docsearch-scraper\n')),(0,a.yg)("p",null,"Once the scraping finishes, you can ",(0,a.yg)("a",{parentName:"p",href:"#integration"},"jump to the Integration step"),"."),(0,a.yg)("h2",{id:"running-the-crawler-from-the-code-base"},"Running the crawler from the code base"),(0,a.yg)("h3",{id:"installation"},"Installation"),(0,a.yg)("p",null,"The scraper is a python tool ",(0,a.yg)("a",{parentName:"p",href:"https://scrapy.org/"},"based on scrapy"),". We do recommend to use ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/pypa/pipenv"},"pipenv")," to install the python environment."),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://github.com/spader/docsearch-scraper"},"Clone the scraper repository"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://pipenv.readthedocs.io/en/latest/install/#installing-pipenv"},"Install pipenv")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"pipenv install")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"pipenv shell"))),(0,a.yg)("p",null,"If you plan to use the browser emulation ",(0,a.yg)("a",{parentName:"p",href:"/docs/legacy/config-file"},"(",(0,a.yg)("inlineCode",{parentName:"a"},"js_render")," set to true)"),", you need to follow this extra step. If you don't, you can dismiss this step."),(0,a.yg)("h3",{id:"installing-chrome-driver"},"Installing Chrome driver"),(0,a.yg)("p",null,"Some websites rendering requires JavaScript. Our crawler relies on a headless chrome emulation. You will need to set up a ChromeDriver."),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"http://chromedriver.chromium.org/getting-started"},"Install the driver")," suited to your OS and the version of your Chrome. We do recommend to use the latest version."),(0,a.yg)("li",{parentName:"ul"},"Set the environment variable ",(0,a.yg)("inlineCode",{parentName:"li"},"CHROMEDRIVER_PATH")," in your ",(0,a.yg)("inlineCode",{parentName:"li"},".env")," file. This path must target the downloaded extracted driver.")),(0,a.yg)("p",null,"You are ready to go."),(0,a.yg)("h3",{id:"running-the-crawler"},"Running the crawler"),(0,a.yg)("p",null,"Running ",(0,a.yg)("inlineCode",{parentName:"p"},"pipenv shell")," will enable your virtual environment. From there, you can run one crawl with the following command:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},"$ ./docsearch run /path/to/your/config.json\n")),(0,a.yg)("p",null,"Or from the Docker image:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},"$ ./docsearch docker:run /path/to/your/config.json\n")),(0,a.yg)("p",null,"This will start the crawl. It extracts content from parsed pages and push the built records to Spader."),(0,a.yg)("h2",{id:"create-a-new-configuration"},"Create a new configuration"),(0,a.yg)("p",null,"To create a configuration, run ",(0,a.yg)("inlineCode",{parentName:"p"},"./docsearch bootstrap"),". A prompt will ask you for some information and will create a JSON configuration you can use as a base."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},'$ ./docsearch bootstrap\n# Enter your documentation url\nstart url: http://www.example.com/docs/\n# Pick another name, or press enter\nindex_name is example [enter to confirm]: <Enter>\n\n=================\n{\n  "index_name": "example",\n  "start_urls": [\n    "http://www.example.com/docs/"\n  ],\n  "stop_urls": [],\n  "selectors": {\n    "lvl0": "FIXME h1",\n    "lvl1": "FIXME h2",\n    "lvl2": "FIXME h3",\n    "lvl3": "FIXME h4",\n    "lvl4": "FIXME h5",\n    "lvl5": "FIXME h6",\n    "text": "FIXME p, FIXME li"\n  }\n}\n=================\n')),(0,a.yg)("p",null,"Create a file from this text into a filename ",(0,a.yg)("inlineCode",{parentName:"p"},"example.json"),", we'll use it later on to start the crawl. You can browse the ",(0,a.yg)("a",{parentName:"p",href:"https://github.com/spader/docsearch-configs/tree/master/configs"},"list of live configurations"),"."),(0,a.yg)("h2",{id:"testing-your-results"},"Testing your results"),(0,a.yg)("p",null,"You can test your results by running ",(0,a.yg)("inlineCode",{parentName:"p"},"./docsearch playground"),". This will open a web page with a search input. You can do live tests against the indexed results."),(0,a.yg)("img",{src:"https://docsearch.spader.com/img/assets/playground.png",alt:"Playground"}),(0,a.yg)("p",null,(0,a.yg)("em",{parentName:"p"},"Note that if the command fails (it can happen on non-Mac machines), you can get the same result by running a live server in the ",(0,a.yg)("inlineCode",{parentName:"em"},"./playground")," subdirectory.","`")),(0,a.yg)("h2",{id:"integration"},"Integration"),(0,a.yg)("p",null,"Once you're satisfied with your config, you can integrate the dropdown menu in your website by following the ",(0,a.yg)("a",{parentName:"p",href:"/docs/legacy/dropdown"},"instructions here"),"."),(0,a.yg)("p",null,"The difference is that you'll also have to add the ",(0,a.yg)("inlineCode",{parentName:"p"},"appId")," key to your ",(0,a.yg)("inlineCode",{parentName:"p"},"docsearch()")," instance. Also don't forget to use a ",(0,a.yg)("strong",{parentName:"p"},"search")," API key here (in other words, not the ",(0,a.yg)("strong",{parentName:"p"},"write")," API key you used for the crawl)."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-javascript"},"docsearch({\n  appId: '<APP_ID>', // Add your own Application ID\n  apiKey: '<API_KEY>', // Set it to your own *search* API key\n  [\u2026] // Other parameters are the same\n});\n")),(0,a.yg)("h2",{id:"help"},"Help"),(0,a.yg)("p",null,"You can run ",(0,a.yg)("inlineCode",{parentName:"p"},"./docsearch")," without any argument to see the list of all available commands."),(0,a.yg)("p",null,(0,a.yg)("em",{parentName:"p"},"Note that we use this command-line tool internally at Spader to run the free hosted version, so you might not need all the listed commands.")))}y.isMDXComponent=!0}}]);